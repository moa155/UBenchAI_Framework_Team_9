# InferBench Server Recipe: Qdrant Vector Database
# This recipe deploys Qdrant for vector similarity search benchmarking

name: qdrant-vectordb
type: server
description: "Qdrant vector database for RAG and similarity search benchmarking"
version: "1.0.0"

# Container configuration
container:
  image: /project/home/p200776/containers/qdrant-latest.sif
  runtime: apptainer
  binds:
    - /project/home/p200776/qdrant-data:/qdrant/storage:rw

# Resource requirements for SLURM
resources:
  nodes: 1
  gpus: 0  # Qdrant can run CPU-only
  cpus_per_task: 16
  memory: 64G
  time: "04:00:00"
  partition: cpu

# Network configuration
network:
  ports:
    - name: http
      port: 6333
      protocol: http
    - name: grpc
      port: 6334
      protocol: grpc

# Environment variables
environment:
  QDRANT__STORAGE__STORAGE_PATH: "/qdrant/storage"
  QDRANT__SERVICE__HTTP_PORT: "6333"
  QDRANT__SERVICE__GRPC_PORT: "6334"
  QDRANT__LOG_LEVEL: "INFO"

# Command to run inside container
command: |
  ./qdrant

# Health check configuration
healthcheck:
  enabled: true
  endpoint: /healthz
  port: 6333
  interval: 30
  timeout: 10
  retries: 3
  initial_delay: 15

# Metrics endpoint
metrics:
  enabled: true
  endpoint: /metrics
  port: 6333
  type: prometheus

# Labels for organization
labels:
  category: storage
  type: vectordb
  engine: qdrant
